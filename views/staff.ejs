<%- include("modules/header.ejs", {
    pageTitle: pageTitle,
    pageDescription: "Featuring all staff of present and past."
}) %>

<%- include("modules/navigationBar.ejs") %>

<%- include("partials/miniHeader.ejs", {
  headerTitle: "Staff",
  backgroundImage: globalImage
}) %>

<section class="section">
    <div class="container">
        <!-- Sort ranks by priority (higher numbers first) -->
        <% staffData.ranks
            .sort((a, b) => b.priority - a.priority) // Descending order
            .forEach(rank => { 
              // Calculate total users in this rank
              const totalUsers = staffData.rankUsers.filter(rankUser => rankUser.rankSlug == rank.rankSlug).length;
        %>

        <% if (rank.rankSlug == "default" || rank.rankSlug == "retired" || rank.isDonator == 1 || rank.isStaff == 0) { %>
          <% return %>
        <% } %>

        <!-- Display rank name and total users -->
        <h2 style="color: <%= rank.rankTextColour %>;"><%= rank.displayName %>  
          <span class="badge badge-secondary"><%= totalUsers %></span>
        </h2>

        <!-- Centered Columns for Rank Users -->
        <div class="container text-center">
          <div class="row justify-content-center">
            <% staffData.rankUsers.forEach(rankUser => { %>
              <% if (rankUser.rankSlug == rank.rankSlug) { %>
                <div class="col-md-3 col-sm-6 mb-4">
                  <img src="<%= rankUser.profilePicture %>" 
                       alt="<%= rankUser.username %>'s Avatar"
                       class="img-fluid rounded-circle mx-auto d-block"
                       style="height: 100px; width: 100px; object-fit: cover; margin-bottom: 10px;">
                  <h4><%= rankUser.username %></h4>
                  <small class="text-muted"><%= rankUser.title %></small>
                </div>
              <% } %>
            <% }) %>
          </div>
        </div>
        
        <hr>
      <% }) %>
    </div>
</section>

<%- include("modules/footer.ejs") %>
